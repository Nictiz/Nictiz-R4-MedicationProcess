<?xml version="1.0" encoding="utf-8"?>
<OperationDefinition xmlns="http://hl7.org/fhir">    
    <id value="mp-latest-stop"/>
    <url value="http://nictiz.nl/fhir/OperationDefinition/mp-latest-stop"/>
    <version value="2.0.0-rc.3"/>
    <name value="MpLatestStop"/>
    <status value="active"/>
    <kind value="operation"/>    
    <experimental value="false"/>
    <publisher value="Nictiz"/>
    <contact>
        <name value="Nictiz"/>
        <telecom>
            <system value="url"/>
            <value value="https://www.nictiz.nl"/>
            <use value="work"/>
        </telecom>
    </contact>    
    <description value="This operation determines, for a given patient, the latest stop per pharmaceutical treatment (MBH) based on MedicationAgreement (MedicatieAfspraak, MA), AdministrationAgreement (ToedieningsAfspraak, TA) and MedicationRequest resources representing a VariableDosingRegimen (WisselendDoseerSchema, WDS) in the source system.
                        
                        When invoked in the context of a specific kind of building block (e.g. MedicationAgreement/MA, AdministrationAgreement/TA or VariableDosingRegimen/WDS), the server SHALL return the active and latest stopped building blocks of that kind for each pharmaceutical treatment/MBH.
                        
                        If requested (e.g. via the include-details parameter), the server MAY also return the underlying MedicationAgreement, AdministrationAgreement and VariableDosingRegimen resources that were used to determine the latest stop per MBH."/>
    <purpose value="To provide a deterministic, server-side application of the 'latest stop per MBH' rule in the MedicationProcess, so that clients can obtain a consistent view of stopped and ongoing medication without having to reimplement stop logic themselves."/>
    <code value="latest-stop"/>
    <system value="true"/>
    <type value="true"/>
    <instance value="false"/>    
    <!-- The resources that this OperationDefinition applies to -->
    <resource value="MedicationRequest"/>
    <resource value="MedicationStatement"/>
    <resource value="MedicationDispense"/>
    <parameter>
        <name value="patient"/>
        <use value="in"/>
        <min value="1"/>
        <max value="1"/>
        <type value="Reference"/>
        <documentation value="Patient for whom the latest stop per MBH should be determined. The reference SHALL point to a Patient resource that is resolvable on the server."/>
        <targetProfile value="http://hl7.org/fhir/StructureDefinition/Patient"/>
    </parameter>
    <parameter>
        <name value="mbh"/>
        <use value="in"/>
        <min value="0"/>
        <max value="*"/>
        <type value="Identifier"/>
        <documentation value="Optional restriction to one or more specific pharmaceutical treatments (MBHs). If omitted, the server SHALL determine the latest stop for all MBHs in the source system for the given patient."/>
    </parameter>
    <parameter>
        <name value="include-details"/>
        <use value="in"/>
        <min value="0"/>
        <max value="1"/>
        <type value="boolean"/>
        <documentation value="If true, the returned Bundle SHOULD include not only the resulting Medication resources after applying the latest stop logic, but also the underlying MedicationAgreement (MedicatieAfspraak), AdministrationAgreement (ToedieningsAfspraak) and VariableDosingRegimen (WisselendDoseerschema) resources that define the last stop per MBH. Typically using additional Bundle.entry or _include-style semantics."/>
    </parameter>
    <parameter>
        <name value="return"/>
        <use value="out"/>
        <min value="1"/>
        <max value="1"/>
        <type value="Bundle"/>
        <documentation value="Bundle containing the results after applying the latest stop logic per MBH for the given patient (and any optional filters).&#xA;&#xA;When the operation is invoked in the context of a specific kind (MA, TA or WDS), the Bundle SHALL at least contain the building blocks of that kind that are active or represent the latest stop per MBH, including latest stopped building blocks of that kind even if their PeriodOfUse lies outside the searched period."/>
    </parameter>
    
</OperationDefinition>